"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),EatThemAll=function(){function n(t,i){var r=this;_classCallCheck(this,n);this.canvas=t[0];this.server=i;this.ctx=canvas.getContext("2d");this.running=!1;this.width=this.height=5e3;this.resize();this.initialized=!1;this.id="";this.gridSize=30;this.player;this.isDead=!1;this.forceStop=!1;typeof navigator.accelerometer!="undefined"?this.accelerationWatchId=navigator.accelerometer.watchAcceleration(function(n){if(r.initialized&&r.running){var t={x:n.y.toFixed(1),y:n.x.toFixed(1)};r.server.updateDirection(t)}},function(){navigator.notification.alert("Acceleration error.",function(){},"Acceleration","OK")},{frequency:300}):typeof navigator.notification!="undefined"&&navigator.notification.alert("accelerometer is not available.",function(){},"Accelerometer","OK");$(window).bind("resize",function(){return r.resize()});t.bind("click contextmenu",function(n){if(r.isDead&&(r.isDead=!1,$.connection.hub.start()),n.preventDefault(),r.initialized&&r.running){var t={x:(n.offsetX-r.offset.x)/(r.offset.x/5),y:(n.offsetY-r.offset.y)/(r.offset.y/5)};r.server.updateDirection(t)}})}return _createClass(n,[{key:"start",value:function(){this.running=!0;this.isDead=!1}},{key:"stop",value:function(){this.running=!1}},{key:"resize",value:function(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.offset={x:this.canvas.width/2,y:this.canvas.height/2}}},{key:"checkInitialize",value:function(){this.initialized=typeof this.ctx!="undefined"&&(typeof this.id!="undefined"||this.id!="")&&typeof this.server!="undefined"}},{key:"clearCanvas",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"render",value:function(n,t){var i=this;if(this.running&&this.initialized&&!this.isDead){if(this.clearCanvas(),this.player=n.find(function(n){return n.id===i.id}),this.player==null){this.server.getConnectionId();return}this.renderGrid({x:-this.player.location.x%this.gridSize,y:-this.player.location.y%this.gridSize});this.ctx.shadowBlur=10;n.forEach(function(n){return i.renderPlayer(n)});t.forEach(function(n){return i.renderFood(n)});this.ctx.shadowBlur=0;this.renderLabels()}}},{key:"renderLabels",value:function(){this.ctx.globalAlpha=1;this.ctx.fillStyle="black";this.ctx.font="20px Arial";this.ctx.textAlign="center";this.ctx.textBaseline="top";this.ctx.fillText("Score: "+this.player.score,this.canvas.width/2,0)}},{key:"renderPlayer",value:function(n){var t={x:n.location.x-this.player.location.x+this.offset.x,y:n.location.y-this.player.location.y+this.offset.y};t.x<-n.radius||t.y<-n.radius||t.x>this.canvas.width+n.radius||t.y>this.canvas.height+n.radius||(this.ctx.globalAlpha=n.alpha,this.ctx.beginPath(),this.ctx.fillStyle=n.color,this.ctx.arc(t.x,t.y,n.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.fillStyle="black",this.ctx.font="12px Arial",this.ctx.fillText(n.name+("["+n.location.x+","+n.location.y+"]"),t.x,t.y-n.radius))}},{key:"renderFood",value:function(n){var t={x:n.location.x-this.player.location.x+this.offset.x,y:n.location.y-this.player.location.y+this.offset.y};t.x<-n.radius||t.y<-n.radius||t.x>this.canvas.width+n.radius||t.y>this.canvas.height+n.radius||(this.ctx.globalAlpha=n.alpha,this.ctx.beginPath(),this.ctx.fillStyle=n.color,this.ctx.arc(t.x,t.y,n.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.ctx.font="12px Arial",this.ctx.fillText(n.score.toString(),t.x,t.y))}},{key:"renderGrid",value:function(n){for(var i,t=n.x;t<this.canvas.width;t+=this.gridSize)this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.canvas.height);for(i=n.y;i<this.canvas.height;i+=this.gridSize)this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i);this.ctx.globalAlpha=.3;this.ctx.strokeWidth=.1;this.ctx.strokeStyle="Black";this.ctx.stroke()}},{key:"notifyDead",value:function(n){this.running&&this.initialized&&(this.isDead=!0,this.forceStop=!0,this.stop(),$.connection.hub.stop(),typeof navigator.vibrate!="undefined"&&navigator.vibrate(2e3),this.ctx.globalAlpha=1,this.ctx.textAlign="center",this.ctx.fillStyle="black",this.ctx.textBaseline="bottom",this.ctx.font="40px Arial",this.ctx.fillText("You diedededed, final score "+n,this.offset.x,this.offset.y),this.ctx.textBaseline="top",this.ctx.font="25px Arial",this.ctx.fillText("Tap to start again",this.offset.x,this.offset.y))}},{key:"renderInfo",value:function(n){this.clearCanvas();this.ctx.globalAlpha=1;this.ctx.fillStyle="black";this.ctx.font="40px Arial";this.ctx.textAlign="center";this.ctx.textBaseline="middle";this.ctx.fillText(n,this.offset.x,this.offset.y)}},{key:"id",set:function(n){this._id=n;this.checkInitialize()},get:function(){return this._id}},{key:"forceStop",set:function(n){this._forceStop=n;n&&this.stop()},get:function(){return this._forceStop}}]),n}();